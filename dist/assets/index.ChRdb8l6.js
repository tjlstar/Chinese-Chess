(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();let l,m,oe,re,ue,fe,C,ie,he,y,P,p,se=null,j,H=!1,b=[],w=0,M=!1,le,h,ae,T=!1,O=1;const q=10,k=9,Re=[["BR1","BH1","BE1","BA1","BK","BA2","BE2","BH2","BR2"],[],["","BC1","","","","","","BC2",""],["BP1","","BP2","","BP3","","BP4","","BP5"],[],[],["RP1","","RP2","","RP3","","RP4","","RP5"],["","RC1","","","","","","RC2",""],[],["RR1","RH1","RE1","RA1","RK","RA2","RE2","RH2","RR2"]],Ae={RK:"帅",RA:"仕",RE:"相",RH:"马",RR:"车",RC:"炮",RP:"兵",BK:"将",BA:"士",BE:"象",BH:"馬",BR:"車",BC:"砲",BP:"卒"};let c=[],f="R",v=null,de=[],me=0,G=0,g=!1,V=[],U=2,ce=null;function u(n,e=3e3,t=!1){y?(y.textContent=n,y.classList.remove("hidden"),y.classList.toggle("bg-red-500",t),y.classList.toggle("bg-green-500",!t),y.classList.toggle("text-white",!0),ce&&clearTimeout(ce),ce=setTimeout(()=>{y.classList.add("hidden")},e)):console.error("showTemporaryMessage called, but popupMessageElement is null. Message:",n)}function I(n=!1){if(!l||!P||!m||!y){console.error("Cannot initialize board, essential DOM elements missing.");const t="错误: 初始化游戏板失败 (关键元素丢失)。";y?u(t,5e3,!0):console.error(t);return}if(g=!1,f="R",v=null,typeof $=="function"&&$(),V=[],l.querySelectorAll(".square").length===0){l.querySelectorAll(".palace-line").forEach(o=>o.remove());for(let o=0;o<q;o++)for(let i=0;i<k;i++){const r=document.createElement("div");r.classList.add("square"),r.dataset.row=o,r.dataset.col=i,r.addEventListener("click",()=>Le(o,i));const s=l.querySelector(".river-overlay");s?l.insertBefore(r,s):(console.warn("River overlay not found, appending square directly to board."),l.appendChild(r))}}c=JSON.parse(JSON.stringify(Re)).map(t=>{const o=new Array(k).fill(null);return t.forEach((i,r)=>{i&&(o[r]=i)}),o}),typeof F=="function"&&F(),typeof z=="function"&&setTimeout(z,50),u(f==="R"?"红方先行":"黑方先行",2e3),m.textContent="重新开始",l.style.pointerEvents="auto",n&&(me=0,G=0),typeof x=="function"&&x();let e="未知";U===2?e="易":U===3?e="中":U===4&&(e="难"),P.textContent=`当前难度: ${e}`}function F(){if(!l){console.error("renderBoardFromState: boardElement is null.");return}l.querySelectorAll(".piece").forEach(e=>e.remove()),typeof $=="function"&&$();for(let e=0;e<q;e++)for(let t=0;t<k;t++){const o=c[e][t];o&&typeof X=="function"&&X(o,e,t)}}function X(n,e,t){if(!l){console.error("createPieceElement: boardElement is null.");return}const o=document.createElement("div");o.classList.add("piece");const i=n.substring(0,2),r=n.charAt(0);o.classList.add(r==="R"?"red-piece":"black-piece"),o.textContent=Ae[i]||i[1],o.dataset.piece=n;const s=l.querySelector(`.square[data-row='${e}'][data-col='${t}']`);if(s){const a=s.querySelector(".piece");a&&a.remove(),s.appendChild(o)}else console.warn(`createPieceElement: square not found for row ${e}, col ${t}`)}function z(){if(!l){console.error("drawPalaceLines: boardElement is null.");return}l.querySelectorAll(".palace-line").forEach(t=>t.remove());const e=l.querySelector(".square");if(!e||e.offsetWidth===0){setTimeout(z,50);return}typeof K=="function"&&(K(7,3,9,5),K(7,5,9,3),K(0,3,2,5),K(0,5,2,3))}function K(n,e,t,o){if(!l){console.error("drawLine: boardElement is null.");return}const i=l.querySelector(`.square[data-row='${n}'][data-col='${e}']`),r=l.querySelector(`.square[data-row='${t}'][data-col='${o}']`);if(!i||!r){console.warn(`drawLine: start or end square not found for (${n},${e}) to (${t},${o})`);return}const s=i.offsetWidth;if(s===0)return;const a=document.createElement("div");a.classList.add("palace-line");const B=i.offsetLeft+s/2,d=i.offsetTop+s/2,J=r.offsetLeft+s/2,Y=r.offsetTop+s/2,ee=Math.sqrt((J-B)**2+(Y-d)**2),te=Math.atan2(Y-d,J-B)*180/Math.PI;a.style.width=`${ee}px`,a.style.height="2px",a.style.top=`${d}px`,a.style.left=`${B}px`,a.style.transformOrigin="0 0",a.style.transform=`rotate(${te}deg)`,l.appendChild(a)}function x(){ue?ue.textContent=me:console.warn("updateScoreDisplay: redScoreElement is null."),fe?fe.textContent=G:console.warn("updateScoreDisplay: blackScoreElement is null.")}function Le(n,e){if(g)return;if(f==="B"){u("请等待黑方(AI)思考完成",1500,!0);return}typeof $=="function"&&$();const t=c[n][e];if(v){const o=c[n][e];pe(v.row,v.col,n,e,v.piece)?o&&o.charAt(0)===v.piece.charAt(0)?typeof D=="function"&&D(n,e,t):typeof Q=="function"&&Q(v.row,v.col,n,e):t&&t.charAt(0)===f&&typeof D=="function"&&D(n,e,t)}else t&&t.charAt(0)===f&&typeof D=="function"&&D(n,e,t)}function D(n,e,t){if(!l){console.error("selectPiece: boardElement is null.");return}if(v){const i=l.querySelector(`.square[data-row='${v.row}'][data-col='${v.col}']`);if(i){const r=i.querySelector(".piece");r&&r.classList.remove("selected")}}v={piece:t,row:n,col:e};const o=l.querySelector(`.square[data-row='${n}'][data-col='${e}']`);if(o){const i=o.querySelector(".piece");i&&i.classList.add("selected")}typeof ve=="function"&&ve(n,e,t)}function ve(n,e,t){if(!l){console.error("showValidMoves: boardElement is null.");return}typeof $=="function"&&$();for(let o=0;o<q;o++)for(let i=0;i<k;i++)if(pe(n,e,o,i,t)){const r=l.querySelector(`.square[data-row='${o}'][data-col='${i}']`);if(r){const s=document.createElement("div");s.classList.add("valid-move"),r.appendChild(s),de.push(s)}}}function $(){de.forEach(n=>n.remove()),de=[]}function Q(n,e,t,o){if(g||!l){console.warn("movePiece: Game over or boardElement is null.");return}H=!0,!M&&!g&&!T&&Z();const i=c[n][e],r=c[t][o];V.push({boardState:JSON.parse(JSON.stringify(c)),currentPlayer:f,capturedPieceId:r}),c[t][o]=i,c[n][e]=null;const s=l.querySelector(`.square[data-row='${n}'][data-col='${e}']`),a=l.querySelector(`.square[data-row='${t}'][data-col='${o}']`);if(r){const d=a?a.querySelector(".piece"):null;d&&d.remove()}if(s){const d=s.querySelector(".piece");d&&(d.classList.remove("selected"),a&&a.appendChild(d))}else typeof X=="function"&&X(i,t,o);if(v=null,r){const d=r.substring(0,2);if(d==="BK"){typeof L=="function"&&L("R","黑方【将】被吃");return}if(d==="RK"){typeof L=="function"&&L("B","红方【帅】被吃");return}}const B=f==="R"?"B":"R";if(Oe(B)){typeof L=="function"&&L(f,`${B==="R"?"红方":"黑方"}被将死`);return}if(Ne(B)){typeof L=="function"&&L(f,`${B==="R"?"红方":"黑方"}无棋可走 (困毙)`);return}typeof Be=="function"&&Be(),j&&(j.currentTime=0,j.play().catch(d=>console.warn("Audio play failed:",d)))}function L(n,e){if(!m||!l||!y){console.error("endGame: Essential DOM elements missing (resetButton, boardElement, or popupMessageElement).");return}p&&(p.terminate(),p=new Worker(new URL(""+new URL("ai-worker-ciCN5DwY.js",import.meta.url).href,import.meta.url),{type:"module"}),N()),g=!0;let t="",o="";n==="R"?(me++,t="红方胜利",o="红方得1分",typeof x=="function"&&x(),u(`恭喜${t}！${e}。(${o}) 重置棋盘中...`,2e3),setTimeout(()=>{typeof I=="function"&&I(!1),f="R",g=!1,typeof S=="function"&&S(),l&&(l.style.pointerEvents="auto"),m&&(m.textContent="重新开始")},1500)):n==="B"?(G++,t="黑方胜利",o="黑方得1分",typeof x=="function"&&x(),u(`${t}！${e}。(${o}) 重置棋盘中...`,2e3),setTimeout(()=>{typeof I=="function"&&I(!1),f="B",g=!1,typeof S=="function"&&S(),l&&(l.style.pointerEvents="none"),m&&(m.textContent="重新开始"),u("黑方思考中...",1500),setTimeout(()=>{typeof _=="function"&&!g&&p&&_()},500)},1500)):(t="平局",u(`${t}！${e}。点击"再来一盘"开始新游戏`,5e3),m.textContent="再来一盘",l.style.pointerEvents="none",m&&(m.classList.add("highlight-button"),setTimeout(()=>{m.classList.remove("highlight-button")},5e3)))}function Be(){g||(f=f==="R"?"B":"R",l&&(f==="B"?l.style.pointerEvents="none":l.style.pointerEvents="auto"),typeof S=="function"&&S(),f==="B"&&!g&&p&&(u("黑方思考中...",1500),setTimeout(_,500)))}function S(){g||u(`轮到 ${f==="R"?"红方":"黑方"} 行动`)}function pe(n,e,t,o,i){if(!Ie(n,e,t,o,i))return!1;const r=i.charAt(0),s=c[t][o];c[t][o]=i,c[n][e]=null;const a=ge(r);return c[n][e]=i,c[t][o]=s,!a}function Ie(n,e,t,o,i){const r=i.substring(1,2),s=i.charAt(0);if(n===t&&e===o)return!1;const a=c[t][o];if(a&&a.charAt(0)===s||t<0||t>=q||o<0||o>=k)return!1;switch(r){case"K":return Pe(n,e,t,o,s);case"A":return xe(n,e,t,o,s);case"E":return qe(n,e,t,o,s);case"H":return $e(n,e,t,o);case"R":return Ce(n,e,t,o);case"C":return Te(n,e,t,o);case"P":return De(n,e,t,o,s);default:return!1}}function Se(n,e,t){return e<3||e>5?!1:t==="R"?n>=7&&n<=9:t==="B"?n>=0&&n<=2:!1}function Pe(n,e,t,o,i){if(!Se(t,o,i))return!1;const r=Math.abs(n-t),s=Math.abs(e-o);return r===1&&s===0||r===0&&s===1}function xe(n,e,t,o,i){return Se(t,o,i)?Math.abs(n-t)===1&&Math.abs(e-o)===1:!1}function qe(n,e,t,o,i){return!(!(Math.abs(n-t)===2&&Math.abs(e-o)===2)||i==="R"&&t<5||i==="B"&&t>4||c[n+(t-n)/2][e+(o-e)/2])}function $e(n,e,t,o,i){const r=Math.abs(n-t),s=Math.abs(e-o);if(!(r===1&&s===2||r===2&&s===1))return!1;if(r===2){if(c[n+(t-n)/2][e])return!1}else if(c[n][e+(o-e)/2])return!1;return!0}function Ce(n,e,t,o,i){if(n!==t&&e!==o)return!1;if(n===t){for(let r=Math.min(e,o)+1;r<Math.max(e,o);r++)if(c[n][r])return!1}else for(let r=Math.min(n,t)+1;r<Math.max(n,t);r++)if(c[r][e])return!1;return!0}function Te(n,e,t,o,i){if(n!==t&&e!==o)return!1;let r=0;if(n===t)for(let s=Math.min(e,o)+1;s<Math.max(e,o);s++)c[n][s]&&r++;else for(let s=Math.min(n,t)+1;s<Math.max(n,t);s++)c[s][e]&&r++;return c[t][o]?r===1:r===0}function De(n,e,t,o,i){const r=t-n,s=o-e;return i==="R"?n>4?r===-1&&s===0:r===-1&&s===0||r===0&&Math.abs(s)===1:n<5?r===1&&s===0:r===1&&s===0||r===0&&Math.abs(s)===1}function _(){if(g||f!=="B"||!p){console.warn("makeAIMove: Conditions not met or AI worker not available.");return}p.postMessage({type:"findBestMove",boardState:c,depth:U})}function Ee(n){const e=n==="R"?"RK":"BK";for(let t=0;t<q;t++)for(let o=0;o<k;o++)if(c[t][o]&&c[t][o].substring(0,2)===e)return{r:t,c:o};return null}function ge(n){const e=Ee(n);if(!e)return!0;const t=n==="R"?"B":"R";for(let i=0;i<q;i++)for(let r=0;r<k;r++){const s=c[i][r];if(s&&s.charAt(0)===t&&Ie(i,r,e.r,e.c,s)&&s.substring(1,2)!=="K")return!0}const o=Ee(t);if(o&&e.c===o.c){let i=!1;for(let r=Math.min(e.r,o.r)+1;r<Math.max(e.r,o.r);r++)if(c[r][e.c]){i=!0;break}if(!i)return!0}return!1}function we(n){for(let e=0;e<q;e++)for(let t=0;t<k;t++){const o=c[e][t];if(o&&o.charAt(0)===n){for(let i=0;i<q;i++)for(let r=0;r<k;r++)if(pe(e,t,i,r,o))return!0}}return!1}function Oe(n){return ge(n)&&!we(n)}function Ne(n){return!ge(n)&&!we(n)}function We(){console.log(`[handleResign] Called. Current player at start of resign: ${f}`),g=!0;const n="B",e="黑方";console.log(`[handleResign] User (Red) is resigning. Winner: ${n}`),G++,console.log(`[handleResign] Black score incremented to: ${G}`),typeof x=="function"&&x(),p?(console.log("[handleResign] Terminating existing AI worker..."),p.onmessage=null,p.terminate(),console.log("[handleResign] Creating new AI worker..."),p=new Worker(new URL(""+new URL("ai-worker-ciCN5DwY.js",import.meta.url).href,import.meta.url),{type:"module"}),typeof N=="function"?(N(),console.log("[handleResign] New AI worker setup complete.")):console.error("[handleResign] setupAIWorker function is not defined!")):console.log("[handleResign] No AI worker instance to terminate/recreate."),u(`重置棋盘中，${e}先行...`,1500),setTimeout(()=>{console.log("[handleResign setTimeout] Starting delayed operations."),typeof I=="function"&&I(!1),f=n,g=!1,console.log(`[handleResign setTimeout] Next turn player set to: ${f}, gameOver reset to false.`),u("红方主动认输。黑方得1分。",3e3),typeof S=="function"&&S(),l&&(l.style.pointerEvents="none",p?(console.log("[handleResign setTimeout] AI's turn (B). Preparing to make AI move for the new game."),u("黑方思考中...",1500),typeof _=="function"&&setTimeout(_,500)):console.error("[handleResign setTimeout] AI's turn, but AI worker is null!")),m&&(m.textContent="重新开始"),console.log("[handleResign setTimeout] Delayed operations complete.")},1500)}function N(){if(!p){console.error("[setupAIWorker] aiWorker is null, cannot set onmessage.");return}console.log("[setupAIWorker] Setting up onmessage for current AI worker instance."),p.onmessage=function(n){const{type:e,move:t}=n.data;if(console.log(`[aiWorker.onmessage] Received message: type=${e}`,t),g&&e==="bestMove"){console.warn("[aiWorker.onmessage] Game is over (gameOver=true), but received a 'bestMove'. Ignoring move from worker.");return}if(e==="bestMove"&&t){if(f!=="B"){console.warn(`[aiWorker.onmessage] Received 'bestMove' but current player is ${f}, not 'B'. Ignoring.`);return}typeof Q=="function"?(console.log("[aiWorker.onmessage] Processing 'bestMove'. Calling movePiece."),Q(t.fromRow,t.fromCol,t.toRow,t.toCol),typeof Me=="function"&&Me(t.fromRow,t.fromCol,t.toRow,t.toCol)):console.error("[aiWorker.onmessage] movePiece function is not defined.")}}}function Ke(){if(g){u("游戏已结束，无法悔棋。",3e3,!0);return}if(f==="B"){u("AI思考中，请稍等...",2e3,!0);return}if(V.length<2){u("无法悔棋，历史记录不足两步。",3e3,!0);return}V.pop();const n=V.pop();n?(c=JSON.parse(JSON.stringify(n.boardState)),f=n.currentPlayer,typeof F=="function"&&F(),v=null,g=!1,l?l.style.pointerEvents="auto":console.warn("handleUndoMove: boardElement is null."),typeof S=="function"&&S(),u("悔棋成功。轮到 "+(f==="R"?"红方":"黑方")+" 行动。")):u("悔棋失败，历史记录异常。",3e3,!0)}function Me(n,e,t,o){if(!l)return;const i=document.getElementById("aiMoveIndicator");i&&(i.remove(),se&&clearTimeout(se));const r=l.querySelector(`.square[data-row='${n}'][data-col='${e}']`),s=l.querySelector(`.square[data-row='${t}'][data-col='${o}']`);if(!r||!s){console.warn("drawAIMoveIndicator: fromSquare or toSquare not found.");return}const a=l.getBoundingClientRect(),B=r.getBoundingClientRect(),d=s.getBoundingClientRect(),J=B.left+B.width/2-a.left,Y=B.top+B.height/2-a.top,ee=d.left+d.width/2-a.left,te=d.top+d.height/2-a.top,W="http://www.w3.org/2000/svg",E=document.createElementNS(W,"svg");E.setAttribute("id","aiMoveIndicator"),E.style.position="absolute",E.style.left=`${a.left+window.scrollX}px`,E.style.top=`${a.top+window.scrollY}px`,E.style.width=`${a.width}px`,E.style.height=`${a.height}px`,E.style.pointerEvents="none",E.style.zIndex="10";const ye=document.createElementNS(W,"defs"),R=document.createElementNS(W,"marker");R.setAttribute("id","arrowhead"),R.setAttribute("markerWidth","6"),R.setAttribute("markerHeight","4.2"),R.setAttribute("refX","6"),R.setAttribute("refY","2.1"),R.setAttribute("orient","auto-start-reverse");const ne=document.createElementNS(W,"polygon");ne.setAttribute("points","0 0, 6 2.1, 0 4.2"),ne.style.fill="rgba(0, 0, 139, 0.9)",R.appendChild(ne),ye.appendChild(R),E.appendChild(ye);const A=document.createElementNS(W,"line");A.setAttribute("x1",J.toString()),A.setAttribute("y1",Y.toString()),A.setAttribute("x2",ee.toString()),A.setAttribute("y2",te.toString()),A.style.stroke="rgba(0, 0, 139, 0.9)",A.style.strokeWidth="5",A.setAttribute("marker-end","url(#arrowhead)"),E.appendChild(A),document.body.appendChild(E),se=setTimeout(()=>{E.remove()},2500)}function Ve(){if(b=[document.getElementById("bgMusic1"),document.getElementById("bgMusic2"),document.getElementById("bgMusic3"),document.getElementById("bgMusic4")],!b.every(e=>e!==null)){console.error("一个或多个背景音乐元素未找到");return}b.forEach((e,t)=>{e.removeAttribute("loop"),e.volume=.2,e.addEventListener("ended",()=>{be()})}),le=document.getElementById("musicToggleButton"),h=document.getElementById("musicToggleIcon"),ae=document.getElementById("nextMusicButton"),le&&h?(h.textContent="🔈",le.addEventListener("click",Ue)):console.error("音乐控制按钮元素未找到"),ae?ae.addEventListener("click",()=>{M?(be(),u("已切换到下一首",1500)):u("请先开启音乐",1500,!0)}):console.error("切换下一首按钮元素未找到"),w=ke(),H&&!T&&(console.log("尝试自动播放初始音乐"),setTimeout(()=>Z(),1e3))}function Z(){b.forEach((e,t)=>{t!==w&&(e.pause(),e.currentTime=0)});const n=b[w];if(n){let e;switch(O){case 3:e=1;break;case 2:e=.6;break;case 1:e=.2;break;case 0:e=0;break}n.volume=e;const t=n.play();t!==void 0&&t.then(()=>{if(M=!0,h)switch(O){case 3:h.textContent="🔊";break;case 2:h.textContent="🔉";break;case 1:h.textContent="🔈";break;case 0:h.textContent="🔇";break}}).catch(o=>{console.warn("无法自动播放背景音乐:",o),M=!1,h&&(h.textContent="🔇"),H||u("点击棋盘或按钮以启用背景音乐",3e3)})}}function ke(){if(b.length<=1)return 0;let n;do n=Math.floor(Math.random()*b.length);while(n===w);return n}function be(){if(!M)return;b[w]&&(b[w].pause(),b[w].currentTime=0),w=ke();const n=b[w];if(n){const e=n.play();e!==void 0&&e.catch(t=>{console.warn("无法播放背景音乐:",t),M=!1,h&&(h.textContent="🔇")})}}function Ue(){O=(O+1)%4;let n,e,t;switch(O){case 3:n=1,e="🔊",t="音量：高",M=!0,T=!1;break;case 2:n=.6,e="🔉",t="音量：中",M=!0,T=!1;break;case 1:n=.2,e="🔈",t="音量：低",M=!0,T=!1;break;case 0:n=0,e="🔇",t="已静音",M=!1,T=!0;break}b.forEach(o=>{o&&(o.volume=n)}),h&&(h.textContent=e),u(t,1500),O>0&&!M&&Z()}window.addEventListener("DOMContentLoaded",()=>{l=document.getElementById("board"),m=document.getElementById("resetButton"),oe=document.getElementById("resignButton"),re=document.getElementById("undoButton"),ue=document.getElementById("redScoreDisplay"),fe=document.getElementById("blackScoreDisplay"),C=document.getElementById("difficultyModal"),ie=document.getElementById("startGameButton"),he=document.querySelectorAll('input[name="modalDifficulty"]'),y=document.getElementById("popupMessage"),P=document.getElementById("currentDifficultyDisplay"),j=document.getElementById("clickSound"),Ve(),p=new Worker(new URL(""+new URL("ai-worker-ciCN5DwY.js",import.meta.url).href,import.meta.url),{type:"module"}),N();const n="错误：界面关键元素丢失，无法启动或重置游戏。";C?C.classList.remove("hidden"):(console.error("CRITICAL: Difficulty modal element not found in DOM. Attempting to start with default settings."),l&&y&&P&&m?I(!0):(console.error("Cannot initialize game due to missing essential DOM elements (fallback path)."),y?u(n,5e3,!0):console.error(n+" (popupMessageElement also missing)"))),ie?ie.addEventListener("click",()=>{he.forEach(e=>{e.checked&&(U=parseInt(e.value))}),C&&C.classList.add("hidden"),H=!0,T=!1,M||Z(),l&&y&&P&&m?I(!0):(console.error("Cannot start game after modal due to missing essential DOM elements."),y?u(n,5e3,!0):console.error(n+" (popupMessageElement also missing)"))}):console.error("CRITICAL: Start game button ('startGameButton') not found in DOM."),m?m.addEventListener("click",()=>{console.log("[resetButton] Clicked."),g=!0,p?(console.log("[resetButton] Terminating existing AI worker..."),p.onmessage=null,p.terminate(),console.log("[resetButton] Creating new AI worker..."),p=new Worker(new URL(""+new URL("ai-worker-ciCN5DwY.js",import.meta.url).href,import.meta.url),{type:"module"}),typeof N=="function"?(N(),console.log("[resetButton] New AI worker setup complete.")):console.error("[resetButton] setupAIWorker function is not defined!")):console.log("[resetButton] No AI worker instance to terminate/recreate."),u("游戏将被彻底重置，包括积分",2e3),C?(console.log("[resetButton] Showing difficulty modal."),C.classList.remove("hidden"),l?l.style.pointerEvents="none":console.warn("[resetButton] boardElement is null while trying to disable pointer events."),P?P.textContent="当前难度: 未选择":console.warn("[resetButton] currentDifficultyDisplay is null.")):(console.error("[resetButton] Difficulty modal not found. Attempting to re-initialize game directly."),l&&y&&P&&m?typeof I=="function"?I(!0):console.error("[resetButton] initializeBoardAndGame function is not defined for direct re-init!"):(console.error("[resetButton] Cannot re-initialize game due to missing essential DOM elements (direct re-init fallback)."),y?u(n,5e3,!0):console.error(n+" (popupMessageElement also missing for direct re-init)")))}):console.error("CRITICAL: Reset button ('resetButton') not found in DOM."),oe?oe.addEventListener("click",We):console.error("CRITICAL: Resign button ('resignButton') not found in DOM."),re?re.addEventListener("click",Ke):console.error("CRITICAL: Undo button ('undoButton') not found in DOM."),window.addEventListener("resize",()=>{typeof z=="function"&&setTimeout(z,100)}),document.addEventListener("click",()=>{H=!0})});
